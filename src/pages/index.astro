---
import Layout from "../layouts/Layout.astro";
import { getIssues } from "../lib/notion";

const issues = await getIssues();

const processedIssues = issues.map((issue) => ({
  id: issue.id,
  coverUrl:
    "files" in issue.properties.cover
      ? issue.properties.cover.files[0]?.file?.url
      : null,
  title: issue.properties.title.title[0].plain_text,
  date: new Date(issue.properties.date.date.start).toLocaleDateString(),
  uniqueId: issue.properties.id.unique_id.number,
  description: issue.properties.description?.rich_text?.[0]?.plain_text,
  raw: issue,
}));
---

<Layout title="Home | Personal Blog">
  <h1 class="text-4xl font-bold mb-8">Welcome to my blog</h1>

  <div class="grid gap-6">
    {
      processedIssues.map((issue) => (
        <>
          <article class="p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
            {issue.coverUrl && (
              <img
                src={issue.coverUrl}
                alt={issue.title}
                class="mb-4 rounded-lg"
              />
            )}
            <p class="text-sm text-gray-500">{issue.date}</p>
            <h2 class="text-2xl font-semibold mb-2">
              <a
                href={`/issues/${issue.id}`}
                class="hover:text-blue-600 dark:hover:text-blue-400"
              >
                {issue.title}
              </a>
              <span class="text-sm text-gray-500 ml-2">({issue.uniqueId})</span>
            </h2>
            <p class="text-gray-600 dark:text-gray-300">{issue.description}</p>
          </article>
          <details>
            <summary>Debug</summary>
            <pre class="text-xs">{JSON.stringify(issue.raw, null, 2)}</pre>
          </details>
        </>
      ))
    }
  </div>
</Layout>
